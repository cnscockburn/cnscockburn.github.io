---
import BaseLayout from "../layouts/BaseLayout.astro";
import { siteConfig } from "../config";
---

<BaseLayout title="Search" description="Search blog posts and site content.">
  <main class="pt-24 sm:pt-32 pb-16 px-6 sm:px-12 md:px-16 lg:px-24">
    <div class="max-w-3xl mx-auto">
      <h1
        class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 dark:text-gray-100 mb-2"
      >
        Search
      </h1>
      <p class="text-gray-600 dark:text-gray-400 mb-8">
        Find blog posts and content across the site.
      </p>

      <div id="search"></div>
    </div>
  </main>
</BaseLayout>

<script is:inline src="/pagefind/pagefind-ui.js"></script>

<script is:inline>
  function initPagefind() {
    const container = document.getElementById("search");
    if (!container) return;

    // Load Pagefind CSS if not already loaded
    if (!document.querySelector('link[href="/pagefind/pagefind-ui.css"]')) {
      const link = document.createElement("link");
      link.rel = "stylesheet";
      link.href = "/pagefind/pagefind-ui.css";
      document.head.appendChild(link);
    }
    
    // Check if PagefindUI is loaded
    if (typeof PagefindUI === "undefined") {
      container.innerHTML = `
        <p class="text-gray-500 dark:text-gray-400 text-center py-12">
          Search is available after the site is built.<br/>
          <span class="text-sm">Run <code class="bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded">npm run build</code> to generate the search index.</span>
        </p>
      `;
      return;
    }

    // Clear previous instance if any
    container.innerHTML = "";
    
    new PagefindUI({
      element: "#search",
      showSubResults: true,
      showImages: false,
    });
  }

  // Init on load
  window.addEventListener("load", initPagefind);
  
  // Init after View Transitions navigation
  document.addEventListener("astro:after-swap", initPagefind);
</script>

<style is:global>
  /* Pagefind UI Theme Overrides */
  :root {
    --pagefind-ui-scale: 1;
    --pagefind-ui-primary: #0f766e;
    --pagefind-ui-text: #1f2937;
    --pagefind-ui-background: #ffffff;
    --pagefind-ui-border: #e5e7eb;
    --pagefind-ui-tag: #f3f4f6;
    --pagefind-ui-border-width: 1px;
    --pagefind-ui-border-radius: 12px;
    --pagefind-ui-font: inherit;
  }

  .dark {
    --pagefind-ui-primary: #14b8a6;
    --pagefind-ui-text: #e5e7eb;
    --pagefind-ui-background: #030712;
    --pagefind-ui-border: #1f2937;
    --pagefind-ui-tag: #111827;
  }

  .pagefind-ui__search-input {
    font-size: 1rem !important;
    padding: 0.75rem 1rem !important;
  }

  .pagefind-ui__result-link {
    font-weight: 600 !important;
  }

  .pagefind-ui__result {
    padding: 1rem 0 !important;
    border-top: 1px solid var(--pagefind-ui-border) !important;
  }
</style>
