---
// ScrollReveal â€” wraps content in a fade-in/slide-up animation on scroll
interface Props {
  delay?: number;
  class?: string;
}

const { delay = 0, class: className = "" } = Astro.props;
---

<div
  class={`scroll-reveal ${className}`}
  style={delay ? `transition-delay: ${delay}ms` : ""}
>
  <slot />
</div>

<style>
  .scroll-reveal {
    opacity: 0;
    transform: translateY(24px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .scroll-reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  let observer;

  function initScrollReveal() {
    observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("visible");
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1, rootMargin: "0px 0px -40px 0px" }
    );

    document.querySelectorAll(".scroll-reveal").forEach((el) => {
      observer.observe(el);
    });
  }

  // Initialize on load and after navigation
  document.addEventListener("astro:page-load", initScrollReveal);

  // disconnect observer before swap to prevent leaks (though mostly harmless here)
  document.addEventListener("astro:before-swap", () => {
    if (observer) observer.disconnect();
  });
</script>
